@page "/Pago"
@attribute [Authorize]
@using Client.Data

<MudCard Elevation="4">
    <EditForm Model="@_model" OnValidSubmit="SavePagoAsync">
        <FluentValidationValidator />
        <MudCard>
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h5">Realizar pago</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                <MudAutocomplete T="UsuarioViewModel" Label="Usuarios" @bind-Value="_model.Cuenta.Usuario"
                                 SearchFunc="@SearchUsuarios" ToStringFunc="@(e => e == null ? null : e.NombreCompleto)"
                                 For="@(() => _model.Cuenta.Usuario)" HelperText="Requerido"
                                 Strict="false" CoerceValue="true" ResetValueOnEmptyText="true" />
                <MudTextField Label="No. Recibo" HelperText="Requerido"
                              @bind-Value="_model.NoRecibo" For="@(() => _model.NoRecibo)" />
                <MudDatePicker Label="Fecha" @bind-Date="_fecha" DisableToolbar="true" HelperText="Requerido" />
                <MudSelect T="int" AnchorOrigin="Origin.BottomCenter"
                           @bind-Value="_model.Cuenta.Tarifa.IdTarifa" For="@(() => _model.Cuenta.Tarifa.IdTarifa)"
                           HelperText="Requerido" SelectedValuesChanged="CalcularCantidad">
                    <MudSelectItem Value="0" Disabled="true">Tarifa</MudSelectItem>
                    @foreach (var tarifa in _listTarifa)
                    {
                        <MudSelectItem Value="@tarifa.IdTarifa">@tarifa.Tipo</MudSelectItem>
                    }
                </MudSelect>
                <MudNumericField Label="Cantidad" Class="mt-3" HelperText="Requerido"
                                 @bind-Value="_model.Cantidad" For="@(() => _model.Cantidad)" Format="N2" />
            </MudCardContent>
            <MudCardActions>
                <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto">Pagar</MudButton>
            </MudCardActions>
        </MudCard>
    </EditForm>
</MudCard>
